# IberComply 项目功能总结

## 📌 项目定位

**IberComply（伊贝合规）** 是一个面向西班牙华人个体经营者的合规风险评估与决策辅助工具。定位为"正式咨询前的风险结构识别工具"，帮助用户在被要求注册 Autónomo/SL 之前，提前了解合规风险暴露程度。

---

## 🎯 核心功能

### 1. **合规风险评估（免费）**

- **输入信息**：
  - 经营阶段（PRE_AUTONOMO / AUTONOMO / SL）
  - 行业选择（13个行业）
  - 月收入范围
  - 员工人数
  - 是否使用 POS 机
  - 行业特定信号（Signals）- 可选填写

- **输出结果**：
  - 风险暴露分数（0-100分）
  - 风险等级标签（可控/观察区/需要行动/高暴露/非常高）
  - 决策建议标题（如："建议注册 Autónomo"）
  - 结论说明
  - Top 3 风险点（免费展示）
  - 基础 Findings 列表
  - 置信度说明

### 2. **付费解锁功能**

系统采用付费墙机制，根据评估结果的风险等级自动触发解锁选项：

#### **基础版（€15）**
解锁内容：
- 判断依据（为什么会得出这个结论）
- 行动清单（3个时间层级：现在就该做 / 接下来几天内完成 / 长期保持）
- 忽视后果（如果长期忽视可能出现的结果）
- 基础版 PDF 报告

#### **专家版（€39）**
包含基础版全部内容，额外解锁：
- 所有 Findings（包括 pro_only 的高级风险点）
- 税务局执法路径说明
- 30 天合规路线图
- 所需材料清单
- 自检清单
- 风险分数构成分析
- 专家版 PDF 报告（包含完整分析）

### 3. **PDF 报告生成**

- **封面页**：专业咨询报告风格，包含评估对象概况
- **结论摘要页**：风险分数说明、决策建议、置信度原因、Top 3 风险点
- **行动清单页**：按时间层级组织的可执行行动列表
- **专家分析页**（仅专家版）：详细的风险分解、路线图、材料清单
- **免责声明页**：法律说明与使用建议

报告特点：
- 支持中文显示
- 专业咨询报告风格
- 包含评估版本号（vYYYY.MM.DD）
- 针对不同解锁层级生成不同内容

### 4. **支付集成（Stripe）**

- Stripe Checkout 集成
- 支持基础版（€15）和专家版（€39）
- 支付成功后自动解锁对应内容
- 支付状态验证机制
- 支付成功页面

---

## 🏭 支持的行业（13个）

1. **百元店/百货** (bazar)
2. **超市** (supermarket)
3. **手机店/配件零售** (phone_shop)
4. **餐厅** (restaurant)
5. **酒吧** (bar)
6. **外卖/配送** (takeaway)
7. **手机卡代理/套餐办理** (telecom_agent)
8. **光纤安装/Orange/Vodafone 代理** (fiber_install)
9. **电子产品维修** (electronics_repair)
10. **美容美发** (beauty)
11. **配送/外卖** (delivery)
12. **广告/传媒** (advertising_media) ⭐ 新增
13. **旅行社/旅游服务** (travel_agency) ⭐ 新增
14. **电商/网店** (ecommerce) ⭐ 新增
15. **其他** (other)

每个行业包含：
- 基础风险分
- 行业标签（tax, consumer, municipal, labor, data, customs 等）
- 行业特定信号（Signals）规则
- 组合风险规则（Combo Rules）

---

## 📊 风险评估模型

### 评分机制

1. **基础分**：行业基础风险分（10-34分）
2. **Signals 分**：行业特定信号触发（上限 22分）
3. **组合加成**：特定信号组合增加风险
4. **收入分**：基于月收入和阶段（PRE_AUTONOMO / AUTONOMO / SL 不同算法）
5. **员工分**：有员工 +25分
6. **POS 分**：使用 POS +15分
7. **扣分项**：合规行为可降低风险

**最终分数**：clamp 到 0-100 分

### Decision 等级

- `OK` - 风险分数 < 25（可控）
- `OBSERVE` - 风险分数 25-39（观察区）
- `REGISTER_AUTONOMO` - 风险分数 40-59（建议注册 Autónomo）
- `STRONG_REGISTER_AUTONOMO` - 风险分数 ≥ 60 且无员工（强烈建议注册）
- `CONSIDER_SL` - 风险分数 ≥ 60 且有员工（建议考虑 SL 公司）

关键触发项会提升一个等级。

---

## 🌐 页面功能

### 1. **首页（Landing Page）**
- 产品介绍和价值主张
- 目标用户痛点说明
- 真实经营场景案例示例（3个）
- 功能说明（会做什么/不会做什么）
- 免费评估 CTA

### 2. **评估表单页**
- 阶段选择
- 行业选择（卡片式，支持搜索）
- 收入范围选择（分段按钮）
- 员工人数选择（Stepper 组件）
- POS 使用开关
- 行业信号选择（折叠面板，按行业显示）

### 3. **评估结果页**
- **免费内容**：
  - 决策建议标题和结论
  - 风险分数和等级
  - 置信度说明（带工具提示）
  - Top 3 风险点
  - 基础 Findings 列表
  
- **解锁区域**：
  - 基础版解锁（€15）- BottomSheet 弹窗
  - 专家版解锁（€39）- BottomSheet 弹窗
  - 解锁后显示完整内容
  
- **其他功能**：
  - PDF 报告下载
  - 进行复评（重新评估）
  - 免责声明链接

### 4. **支付相关页面**
- Stripe Checkout 支付流程
- 支付成功页面
- 支付状态验证

### 5. **信息页面**
- **免责声明页**：产品型免责声明，说明工具定位和边界
- **合作伙伴页**：未来合作占位页，面向 Gestoría/律师事务所

---

## 🔒 付费墙逻辑

### 解锁触发条件
当 `decision_summary.level` 为以下等级时，显示解锁选项：
- `REGISTER_AUTONOMO`
- `STRONG_REGISTER_AUTONOMO`
- `CONSIDER_SL`

### 付费内容控制
- `decision_summary.reasons`（判断依据）
- `decision_summary.recommended_actions`（行动清单）
- `decision_summary.risk_if_ignore`（忽视后果）
- `decision_summary.enforcement_path`（执法路径，仅专家版）
- `findings` 中 `pro_only=true` 的项
- PDF 报告完整内容

---

## 📱 移动端优化

- 单列布局，完美适配手机屏幕
- 底部安全区支持（iPhone 刘海/手势条）
- 卡片式选择组件（行业、收入）
- Stepper 控件（员工人数）
- Switch 控件（POS）
- Signals 折叠面板
- BottomSheet 解锁弹窗（手势关闭）
- 微信浏览器兼容优化

---

## 🛠 技术栈

### 前端
- Next.js 14 (App Router)
- React + TypeScript
- Tailwind CSS
- 移动端优化组件

### 后端
- FastAPI (Python 3.11)
- Pydantic（数据验证）
- PostgreSQL（数据存储）
- Redis（缓存）
- ReportLab（PDF 生成）

### 支付
- Stripe Checkout

### 部署
- Docker Compose

---

## 📋 特色功能

1. **阶段感知评分**：PRE_AUTONOMO / AUTONOMO / SL 三个阶段使用不同的收入评分算法
2. **行业精细化**：13个行业，每个行业有独立的信号规则和组合规则
3. **咨询师风格报告**：PDF 报告采用专业咨询报告风格，非免责声明风格
4. **心理对齐优化**：文案和提示优化，降低用户焦虑，提升信任感
5. **复评机制**：基于规范标准，30天复评建议
6. **版本化管理**：评估版本（vYYYY.MM.DD）+ 规则版本（R{major}.{minor}）

---

## 🎨 产品理念

- **不是税务局**：明确说明平台定位和边界
- **不替代专业服务**：定位为咨询前的风险识别工具
- **降低心理负担**：专业、克制、咨询师语气，而非恐吓
- **可执行性**：提供结构化、分时间层级的行动建议
- **透明度**：清晰说明评分逻辑、置信度、适用范围

